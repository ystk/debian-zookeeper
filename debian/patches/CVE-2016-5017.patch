From: Markus Koschany <apo@debian.org>
Date: Sun, 18 Sep 2016 19:57:53 +0200
Subject: CVE-2016-5017

Lyon Yang discovered that the C client shells cli_st and cli_mt of Apache
Zookeeper, a high-performance coordination service for distributed
applications, were affected by a buffer overflow vulnerability associated with
parsing of the input command when using the "cmd:" batch mode syntax. If the
command string exceeds 1024 characters a buffer overflow will occur.


Origin: https://git-wip-us.apache.org/repos/asf?p=zookeeper.git;a=commitdiff;h=27ecf981a15554dc8e64a28630af7a5c9e2bdf4f
---
 src/c/src/cli.c | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/src/c/src/cli.c b/src/c/src/cli.c
index c4538a6..959dd99 100644
--- a/src/c/src/cli.c
+++ b/src/c/src/cli.c
@@ -486,7 +486,15 @@ int main(int argc, char **argv) {
     }
     if (argc > 2) {
       if(strncmp("cmd:",argv[2],4)==0){
-        strcpy(cmd,argv[2]+4);
+        size_t cmdlen = strlen(argv[2]);
+        if (cmdlen > sizeof(cmd)) {
+            fprintf(stderr,
+                    "Command length %zu exceeds max length of %zu\n",
+                    cmdlen,
+                    sizeof(cmd));
+            return 2;
+        }
+        strncpy(cmd, argv[2]+4, sizeof(cmd));
         batchMode=1;
         fprintf(stderr,"Batch mode: %s\n",cmd);
       }else{
